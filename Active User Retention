LEVEL:-HARD
COMPANY:-Facebook
URL:-https://datalemur.com/questions/user-retention

Question:-
Assume you're given a table containing information on Facebook user actions. Write a query to obtain number of monthly active users (MAUs) in July 2022, 
including the month in numerical format "1, 2, 3".

Hint:

    An active user is defined as a user who has performed actions such as 'sign-in', 'like', or 'comment' in both the current month and the previous month.

Solution-1:-
SELECT 
month AS mth,
COUNT(DISTINCT user_id) AS monthly_active_users
FROM user_actions
WHERE EXTRACT(MONTH FROM event_date)='7'
AND event_type IN ('like', 'sign-in', 'comment')
AND user_id IN (SELECT DISTINCT(user_id)
FROM user_actions
WHERE EXTRACT(MONTH FROM event_date)='6'
AND event_type IN ('like', 'sign-in', 'comment'))
GROUP BY month

Solution-2:-
SELECT 
  EXTRACT(MONTH FROM curr_month.event_date) AS mth, 
  COUNT(DISTINCT curr_month.user_id) AS monthly_active_users 
FROM user_actions AS curr_month
WHERE EXISTS (
  SELECT last_month.user_id 
  FROM user_actions AS last_month
  WHERE last_month.user_id = curr_month.user_id
    AND EXTRACT(MONTH FROM last_month.event_date) =
    EXTRACT(MONTH FROM curr_month.event_date - interval '1 month')
)
  AND EXTRACT(MONTH FROM curr_month.event_date) = 7
  AND EXTRACT(YEAR FROM curr_month.event_date) = 2022
GROUP BY EXTRACT(MONTH FROM curr_month.event_date);
